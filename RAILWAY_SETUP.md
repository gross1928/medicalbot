# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Railway –¥–ª—è –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –ò–ò-–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Railway

–î–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Railway –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

### üîê –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

#### Telegram Bot
```
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
```
- –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç [@BotFather](https://t.me/BotFather) –≤ Telegram
- –ö–æ–º–∞–Ω–¥–∞: `/newbot` ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –∏–º—è ‚Üí —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

#### OpenAI API
```
OPENAI_API_KEY=your_openai_api_key_here
```
- –ü–æ–ª—É—á–∏—Ç–µ –Ω–∞ [platform.openai.com/api-keys](https://platform.openai.com/api-keys)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ

#### Supabase Database
```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your_supabase_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here
```
- –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ [supabase.com](https://supabase.com)
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí API
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL, anon key –∏ service_role key

#### Security
```
SECRET_KEY=your_random_secret_key_minimum_32_characters
```
- –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á –¥–ª–∏–Ω–æ–π –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `openssl rand -hex 32`

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

#### Application Settings
```
APP_ENV=production
APP_HOST=0.0.0.0
APP_PORT=8000
DEBUG=False
```

#### Webhook URL
```
TELEGRAM_WEBHOOK_URL=https://your-railway-app.railway.app
```
- Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç URL –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- –§–æ—Ä–º–∞—Ç: `https://medicalbot-production-xxxx.up.railway.app`

### üìä –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

#### OpenAI Configuration
```
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=2000
```

#### File Processing
```
MAX_FILE_SIZE_MB=20
ALLOWED_FILE_TYPES=pdf,jpg,jpeg,png
OCR_LANGUAGE=rus+eng
```

#### Monitoring
```
LOG_LEVEL=INFO
SENTRY_DSN=your_sentry_dsn_if_needed
```

#### Rate Limiting
```
RATE_LIMIT_PER_MINUTE=10
RATE_LIMIT_PER_HOUR=100
```

#### AI Analysis
```
AI_ANALYSIS_TIMEOUT=120
MAX_BIOMARKERS_PER_ANALYSIS=50
CACHE_ANALYSIS_HOURS=24
```

## üîß –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Railway

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Railway
1. –í–æ–π–¥–∏—Ç–µ –Ω–∞ [railway.app](https://railway.app)
2. –ù–∞–∂–º–∏—Ç–µ "New Project"
3. –í—ã–±–µ—Ä–∏—Ç–µ "Deploy from GitHub repo"
4. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `https://github.com/gross1928/medicalbot.git`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
1. –í –ø–∞–Ω–µ–ª–∏ Railway –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Variables"
3. –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ [supabase.com](https://supabase.com)
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    age INTEGER CHECK (age > 0 AND age <= 150),
    gender VARCHAR(10),
    weight FLOAT CHECK (weight > 0),
    height FLOAT CHECK (height > 0),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE,
    is_active BOOLEAN DEFAULT TRUE
);

-- –ê–Ω–∞–ª–∏–∑—ã
CREATE TABLE analyses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    file_path VARCHAR(1000) NOT NULL,
    original_filename VARCHAR(500) NOT NULL,
    file_type VARCHAR(10) NOT NULL,
    file_size INTEGER NOT NULL,
    status VARCHAR(20) DEFAULT 'pending',
    uploaded_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    processed_at TIMESTAMP WITH TIME ZONE,
    extracted_text TEXT,
    ocr_confidence FLOAT,
    processing_result JSONB,
    analysis_summary TEXT,
    processing_time_seconds FLOAT,
    ai_tokens_used INTEGER,
    error_message TEXT
);

-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–∏–æ–º–∞—Ä–∫–µ—Ä–æ–≤
CREATE TABLE results (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    analysis_id UUID REFERENCES analyses(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    value VARCHAR(255) NOT NULL,
    unit VARCHAR(50),
    reference_range VARCHAR(255),
    status VARCHAR(20) DEFAULT 'unknown',
    interpretation TEXT,
    numeric_value FLOAT,
    normal_min FLOAT,
    normal_max FLOAT,
    clinical_significance TEXT,
    recommendations TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
CREATE TABLE recommendations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    analysis_id UUID REFERENCES analyses(id) ON DELETE CASCADE,
    recommendation_text TEXT NOT NULL,
    category VARCHAR(50) NOT NULL,
    priority VARCHAR(20) DEFAULT 'medium',
    biomarker_name VARCHAR(255),
    target_value VARCHAR(255),
    timeline VARCHAR(255),
    action_items JSONB,
    resources JSONB,
    confidence_score FLOAT,
    scientific_basis TEXT,
    contraindications TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    is_personalized BOOLEAN DEFAULT TRUE
);

-- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –Ω–æ—Ä–º—ã
CREATE TABLE medical_norms (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    biomarker_name VARCHAR(255) NOT NULL,
    unit VARCHAR(50) NOT NULL,
    min_value FLOAT,
    max_value FLOAT,
    gender VARCHAR(10) DEFAULT 'BOTH',
    age_min INTEGER,
    age_max INTEGER,
    source VARCHAR(500),
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE,
    is_active BOOLEAN DEFAULT TRUE,
    version INTEGER DEFAULT 1
);
```

3. –°–æ–∑–¥–∞–π—Ç–µ bucket "medical-files" –≤ Storage:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Storage
   - –ù–∞–∂–º–∏—Ç–µ "Create bucket"
   - –ò–º—è: `medical-files`
   - Public: `false`

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Webhook
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Railway –ø–æ–ª—É—á–∏—Ç–µ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ webhook:
```
TELEGRAM_WEBHOOK_URL=https://your-app-name.up.railway.app
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è
1. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç –±–∏–ª–¥ –∏–∑ Dockerfile
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway –∫–æ–Ω—Å–æ–ª–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚ö†Ô∏è –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª—ã –≤ Git
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
- ‚ö†Ô∏è Service Role Key –¥–µ—Ä–∂–∏—Ç–µ –≤ —Å–µ–∫—Ä–µ—Ç–µ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenAI API
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –≤ Supabase Storage
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### –õ–∏–º–∏—Ç—ã
- OpenAI: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–≥–æ –ø–ª–∞–Ω–∞
- Supabase: 500MB –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ
- Railway: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway –∫–æ–Ω—Å–æ–ª–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–¥–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ OpenAI API –∫–ª—é—á 